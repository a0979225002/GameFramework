{"version":3,"sources":["assets\\script\\Framework\\LoadResources\\LoadType\\SpineLoad.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,sEAA2D;AAC3D,yDAAmD;AACnD,gDAA2C;AAC3C,oDAA+C;AAE/C;IAAuC,6BAAS;IAE5C,mBAAY,QAAgB,EAAE,IAAS,EAAE,GAAW,EAAE,MAAc;eAChE,kBAAM,QAAQ,EAAE,IAAI,EAAE,GAAG,EAAE,MAAM,CAAC;IAEtC,CAAC;IAED,mCAAe,GAAf,UAAgB,GAAW,EAAE,KAA6B;;QAEtD,IAAI,wBAAc,CAAC,QAAQ,CAAC,QAAQ,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE;YAC3C,sBAAY,CAAC,QAAQ,CAAC,YAAY,CAAC,4BAAS,CAAC,WAAW,EAAE,kBAAkB,CAAC,CAAC;SACjF;QAED,wBAAc,CAAC,QAAQ,CAAC,QAAQ,CAAC,GAAG,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;QAEpD,IAAI,SAAS,GAAG,GAAG,CAAC,WAAW,EAAE,CAAC;QAClC,IAAI,SAAS,GAAG,SAAS,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;;YACxC,KAAkB,IAAA,UAAA,SAAA,KAAK,CAAA,4BAAA,+CAAE;gBAApB,IAAI,KAAK,kBAAA;gBAEV,IAAI,UAAU,GAAkB,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC,UAAU,CAAC,CAAC;gBAC3E,IAAI,UAAU,GAAwB,IAAI,GAAG,EAAkB,CAAC;;oBAChE,aAAa;oBACb,KAAsB,IAAA,8BAAA,SAAA,UAAU,CAAA,CAAA,sCAAA,8DAAE;wBAA7B,IAAI,SAAS,uBAAA;wBACd,sCAAsC;wBACtC,IAAI,SAAS,EAAE;4BACX,IAAI,iBAAiB,GAAG,SAAS,CAAC,OAAO,CAAC,UAAU,EAAE,EAAE,CAAC,CAAC;4BAC1D,kCAAkC;4BAClC,IAAI,iBAAiB,KAAK,EAAE,EAAE;gCAC1B,UAAU,CAAC,GAAG,CAAC,SAAS,EAAE,SAAS,CAAC,CAAC;6BACxC;iCAAM;gCACH,IAAI,UAAU,CAAC,GAAG,CAAC,iBAAiB,CAAC,EAAE;oCACnC,sBAAY,CAAC,QAAQ,CAAC,YAAY,CAAC,4BAAS,CAAC,WAAW,EAAK,SAAS,6IAAgD,CAAC,CAAC;iCAC3H;gCACD,UAAU,CAAC,GAAG,CAAC,iBAAiB,EAAE,SAAS,CAAC,CAAC;6BAChD;yBACJ;6BAAM;4BACH,UAAU,CAAC,GAAG,CAAC,SAAS,EAAE,SAAS,CAAC,CAAC;yBACxC;qBACJ;;;;;;;;;gBACH,wBAAwB;aACzB;;;;;;;;;QAED,UAAU;QACV,gCAAgC;QAChC,IAAI,CAAC,iBAAiB,EAAE,CAAC;IAC7B,CAAC;IACL,gBAAC;AAAD,CA9CA,AA8CC,CA9CsC,mBAAS,GA8C/C","file":"","sourceRoot":"/","sourcesContent":["import {ErrorType} from '../../Error/Enum/ErrorManagerEnum'\r\nimport ErrorManager from '../../Error/ErrorManager'\r\nimport ALoadType from \"../ILoad/ALoadType\";\r\nimport LoadResManager from \"../LoadResManager\";\r\n\r\nexport default class SpineLoad extends ALoadType {\r\n\r\n    constructor(dataName: string, type: any, url: string, folder: string) {\r\n        super(dataName, type, url, folder);\r\n\r\n    }\r\n\r\n    setResToManager(key: string, asset: Array<sp.SkeletonData>) {\r\n\r\n        if (LoadResManager.instance.spineRes.has(key)) {\r\n            ErrorManager.instance.executeError(ErrorType.LoadErrorFW, \"請檢察資源是否以載入過,鍵值重複\");\r\n        }\r\n\r\n        LoadResManager.instance.spineRes.set(key, asset[0]);\r\n\r\n        let lowerCase = key.toLowerCase();\r\n        let checkGrid = lowerCase.match(\"grid\");\r\n        for (let spine of asset) {\r\n\r\n            let spineNames: Array<string> = Object.keys(spine.skeletonJson.animations);\r\n            let spineToMap: Map<string, string> = new Map<string, string>();\r\n            //取出spine動畫名稱\r\n            for (let spineName of spineNames) {\r\n                //檢查是否有grid關鍵字,將把取spineName 的key 更換為數字\r\n                if (checkGrid) {\r\n                    let spineNameToNumber = spineName.replace(/[^0-9]/ig, '');\r\n                    //如果動畫內包含不含數字的的動畫名,將直接將動畫名整個保存成key\r\n                    if (spineNameToNumber === \"\") {\r\n                        spineToMap.set(spineName, spineName);\r\n                    } else {\r\n                        if (spineToMap.has(spineNameToNumber)) {\r\n                            ErrorManager.instance.executeError(ErrorType.LoadErrorFW, `${spineName} spine動畫取number有誤,請檢查該spine Animetion是否有重複數字情況`);\r\n                        }\r\n                        spineToMap.set(spineNameToNumber, spineName);\r\n                    }\r\n                } else {\r\n                    spineToMap.set(spineName, spineName);\r\n                }\r\n            }\r\n          //TODO:尚未想到要把grid動換資源放在哪\r\n        }\r\n\r\n        //目的解決異步操作\r\n        //當資源都載入到LoadManager時才回傳以載入完成的狀態\r\n        this.updateProgressEnd();\r\n    }\r\n}"]}