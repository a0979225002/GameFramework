{"version":3,"sources":["assets\\script\\Framework\\Audio\\AudioType\\MusicTypeController.ts"],"names":[],"mappings":";;;;;;AAAA,sEAA2D;AAC3D,yDAAmD;AACnD,qEAA+D;AAE/D,IAAK,cAIJ;AAJD,WAAK,cAAc;IACf,oDAAS,CAAA;IACT,yDAAW,CAAA;IACX,qDAAS,CAAA;AACb,CAAC,EAJI,cAAc,KAAd,cAAc,QAIlB;AAED;;;;;GAKG;AACH;IAII;QACI,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;IACxB,CAAC;IAED;;;;OAIG;IACI,kCAAI,GAAX,UAAY,IAAY,EAAE,IAAsB;QAE5C,IAAI,MAAM,GAAW,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,CAAY,IAAI;QACxD,IAAI,IAAI,GAAY,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAe,MAAM;QAE1D,kCAAkC;QAClC,IAAI,KAAK,GAAW,EAAE,CAAC,WAAW,CAAC,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QAE1D,IAAI,CAAC,wBAAc,CAAC,QAAQ,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE;YAC7C,sBAAY,CAAC,QAAQ,CAAC,YAAY,CAAC,4BAAS,CAAC,OAAO,EAAK,IAAI,4HAA+B,CAAC,CAAC;YAC9F,OAAO;SACV;QAED,iBAAiB;QACjB,IAAI,KAAK,IAAI,cAAc,CAAC,KAAK,EAAE;YAC/B,EAAE,CAAC,WAAW,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YACpC,OAAO;SACV;QAED,mBAAmB;QACnB,IAAG,KAAK,IAAI,cAAc,CAAC,OAAO,EAAC;YAC/B,IAAI,CAAC,IAAI,EAAE,CAAC;SACf;QAED,IAAI,SAAS,GAAG,wBAAc,CAAC,QAAQ,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;QAC3D,IAAI,OAAO,GAAG,EAAE,CAAC,WAAW,CAAC,SAAS,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;QACxD,EAAE,CAAC,WAAW,CAAC,SAAS,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC;QAC1C,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC;IAC3B,CAAC;IAED;;OAEG;IACI,kCAAI,GAAX;QAEI,EAAE,CAAC,WAAW,CAAC,SAAS,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC;QAC1C,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;IAEtC,CAAC;IAED;;OAEG;IACI,mCAAK,GAAZ;QACI,IAAI,EAAE,CAAC,WAAW,CAAC,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC;YAAE,OAAO;QACvD,EAAE,CAAC,WAAW,CAAC,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;IACvC,CAAC;IACL,0BAAC;AAAD,CA5DA,AA4DC,IAAA","file":"","sourceRoot":"/","sourcesContent":["import {ErrorType} from '../../Error/Enum/ErrorManagerEnum'\r\nimport ErrorManager from '../../Error/ErrorManager'\r\nimport LoadResManager from '../../LoadResources/LoadResManager'\r\n\r\nenum MusicStateType{\r\n    STOP = -1,      //無撥放\r\n    PLAYING = 1,    //撥放中\r\n    PAUSE = 2,      //暫停中\r\n}\r\n\r\n/**\r\n * @Author XIAO-LI-PIN\r\n * @Description 音樂撥放|暫停控制器,跟音效類稍微不同,只保存當下一個MusicID\r\n * @Date 2021-04-14 下午 20:24\r\n * @Version 1.1\r\n */\r\nexport default class MusicTypeController implements IAudioType {\r\n\r\n    private musicID: number;\r\n\r\n    constructor() {\r\n        this.musicID = null;\r\n    }\r\n\r\n    /**\r\n     * 撥放背景音樂,並配合享元資料,作相對應的撥放模式處理\r\n     * @param {string} name\r\n     * @param {Map<string, any>} data\r\n     */\r\n    public play(name: string, data: Map<string, any>) {\r\n\r\n        let volume: number = data.get(\"volume\");            //音量\r\n        let loop: boolean = data.get(\"loop\");               //是否循環\r\n\r\n        //獲取當前音樂撥放狀態,-1 無撥放 , 1 撥放中  2 暫停中\r\n        let state: number = cc.audioEngine.getState(this.musicID);\r\n\r\n        if (!LoadResManager.instance.musicRes.has(name)) {\r\n            ErrorManager.instance.executeError(ErrorType.MusicFW, `${name} 無此資源,請檢察資源類 musicRes內的資源是否錯誤`);\r\n            return;\r\n        }\r\n\r\n        //如果該音樂是暫停模式,回復撥放\r\n        if (state == MusicStateType.PAUSE) {\r\n            cc.audioEngine.resume(this.musicID);\r\n            return;\r\n        }\r\n\r\n        //如果上一首背景音樂正在撥放,先暫停\r\n        if(state == MusicStateType.PLAYING){\r\n            this.stop();\r\n        }\r\n\r\n        let audioClip = LoadResManager.instance.musicRes.get(name);\r\n        let musicID = cc.audioEngine.playMusic(audioClip, loop);\r\n        cc.audioEngine.setVolume(musicID, volume);\r\n        this.musicID = musicID;\r\n    }\r\n\r\n    /**\r\n     *停止背景音樂\r\n     */\r\n    public stop() {\r\n\r\n        cc.audioEngine.setVolume(this.musicID, 0);\r\n        cc.audioEngine.stop(this.musicID);\r\n\r\n    }\r\n\r\n    /**\r\n     * 暫停背景音樂\r\n     */\r\n    public pause() {\r\n        if (cc.audioEngine.getState(this.musicID) != 1) return;\r\n        cc.audioEngine.pause(this.musicID);\r\n    }\r\n}"]}