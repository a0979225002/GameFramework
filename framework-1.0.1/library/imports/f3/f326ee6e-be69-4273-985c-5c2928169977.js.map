{"version":3,"sources":["assets\\script\\LoadingScript\\LoadingController.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import SlotConfigManager from \"../Framework/Config/SlotConfigManager\";\r\nimport ButtonMethod from '../Framework/GlobalMethod/ButtonMethod'\r\nimport LanguageMethod from \"../Framework/GlobalMethod/LanguageMethod\";\r\nimport {LoadType} from '../Framework/LoadResources/Enum/LoadEnum'\r\nimport LoadResManager from '../Framework/LoadResources/LoadResManager'\r\nimport {SceneStyle, SceneDirectionType} from '../Framework/Scene/Enum/SceneStyle'\r\nimport SceneManager from '../Framework/Scene/SceneManager'\r\nimport SceneDirectionChangeNotification from \"../Framework/Scene/SceneNotification/SceneDirectionChangeNotification\";\r\nimport SceneDirectionChangeObserver from \"../Framework/Scene/SceneObserver/SceneDirectionChangeObserver\";\r\nimport ALoadingTemplate from '../Framework/Template/Loading/ALoadingTemplate'\r\nimport {socketJS} from \"../Socket/Socket\";\r\nimport SocketSetting from '../Socket/SocketSetting'\r\nimport {WebResponseManager} from \"../Framework/WebResponse/WebResponseManager\";\r\nimport {NoLineTableInfo} from \"../../../Template\";\r\nimport {ResponseType} from \"../Framework/WebResponse/Enum/ResponseType\";\r\nimport NoSleep = require('../Socket/NoSleep');\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class LoadingController extends ALoadingTemplate {\r\n\r\n    @property(cc.ProgressBar)\r\n    private progressBar: cc.ProgressBar = null;\r\n    @property(cc.Button)\r\n    private intoMainGameButton: cc.Button = null;\r\n    @property(cc.Sprite)\r\n    private intoMainGameButtonImg: cc.Sprite = null;\r\n    @property(cc.Node)\r\n    private loadingTextNode: cc.Node = null;\r\n    @property(cc.Sprite)\r\n    private logoImg: cc.Sprite = null;\r\n    @property(cc.Node)\r\n    private loadBG: cc.Node = null;\r\n    private progressNum: number\r\n    private loadTextToArray: Array<cc.Label>;\r\n    private isLogoAnimaEnd: boolean\r\n    private _sceneDirectionChangeObserver: SceneDirectionChangeObserver;\r\n\r\n    /**\r\n     * 自定義初始\r\n     */\r\n    public onCreat() {\r\n        this.tableInfo = WebResponseManager.instance<NoLineTableInfo>().getResult(ResponseType.TABLE_INFO)\r\n        socketJS.SFSLoad(SlotConfigManager.instance.gameNumber);\r\n        this.isLogoAnimaEnd = false;                                    //初始化尚未結束logo動畫\r\n        this.progressNum = 0;                                           //初始進度條為0;\r\n        this.progressBar.progress = this.progressNum;                   //初始UI進度條為0\r\n        this.loadTextToArray = [                                        //存放進度條說明文子Label\r\n            this.loadingTextNode.children[0].getComponent(cc.Label),\r\n            this.loadingTextNode.children[1].getComponent(cc.Label),\r\n        ];\r\n        this.loadTextToArray[0].string                                  //初始第一條進度條文字\r\n            = SocketSetting.t(\"DES_00\" + 1);\r\n        ButtonMethod.addButtonEvent(                                    //添加進入主遊戲Button監聽事件\r\n            this.intoMainGameButton,\r\n            \"intoMainGameButtonEventListener\",\r\n            this\r\n        );\r\n        this.intoMainGameButton.node.active = false;                    //初始關閉進入主遊戲Button顯示,等待進度載入完成後才顯示\r\n        LanguageMethod.instance                                         //初始載入條的說明文字樣式\r\n            .updateLabelStyle(this.loadTextToArray[0])\r\n            .updateLabelStyle(this.loadTextToArray[1])\r\n\r\n        SceneDirectionChangeNotification                                //初始第一次當前分辨率,自動移除監聽\r\n            .instance.subscribe(this.getSceneDirectionChangeObserver(), false);\r\n\r\n        cc.view.on(\"canvas-resize\",this.changeLoadingBG,this)      //持續間當前遊戲長寬,如果有變更,不管是否更換方向都會更新bg大小\r\n    }\r\n\r\n    /**\r\n     * 持續間當前遊戲長寬,如果有變更,不管是否更換方向都會更新bg大小\r\n     */\r\n    changeLoadingBG() {\r\n        if (cc.view.getFrameSize().width < cc.view.getFrameSize().height) {\r\n            let newHeight = 1000 / cc.view.getFrameSize().width * cc.view.getFrameSize().height;\r\n            let newWidth = newHeight / 9 * 16;\r\n            this.loadBG.height = newHeight;\r\n            this.loadBG.width = newWidth;\r\n        } else {\r\n            this.loadBG.height = 960;\r\n            this.loadBG.width = 1560;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 螢幕方向事件觀察員\r\n     * @returns {SceneDirectionChangeObserver}\r\n     */\r\n    getSceneDirectionChangeObserver(): SceneDirectionChangeObserver {\r\n        if (!this._sceneDirectionChangeObserver) {\r\n            this._sceneDirectionChangeObserver =\r\n                new SceneDirectionChangeObserver((type) => {\r\n                    if (type == SceneDirectionType.LANDSCAPE) {\r\n                        this.loadBG.height = 960;\r\n                        this.loadBG.width = 1560;\r\n                    } else {\r\n                        let newHeight = 1000 / cc.view.getFrameSize().width * cc.view.getFrameSize().height;\r\n                        let newWidth = newHeight / 9 * 16;\r\n                        cc.log(newHeight, newWidth);\r\n                        this.loadBG.height = newHeight;\r\n                        this.loadBG.width = newWidth;\r\n                    }\r\n                }, this);\r\n        }\r\n        return this._sceneDirectionChangeObserver;\r\n    }\r\n\r\n    /**\r\n     * 載入主資源\r\n     */\r\n    public onLoadResources() {\r\n        LoadResManager.instance\r\n            .loadAsset(\"music\", LoadType.music, \"music\")\r\n            .loadAsset(\"MainScene\", LoadType.scene, null)\r\n            .loadAsset(\"gridImg\", LoadType.img, \"image/grid/grid\")\r\n            .loadAsset(\"GameIcon\", LoadType.img, \"image/loadLanguage\", true)\r\n            .loadAsset(\"errorFromPrefab\",LoadType.prefab,\"prefab/ErrorFrame\")\r\n            .callback((progress) => {\r\n                if (progress == 1) {\r\n                    this.intoMainGameButtonImg.spriteFrame =\r\n                        LoadResManager.instance.imgRes.get(\"GameIcon\").get(\"btn_start\");\r\n                    this.logoImg.spriteFrame =\r\n                        LoadResManager.instance.imgRes.get(\"GameIcon\").get(\"logo\");\r\n                    this.logoAnimation();\r\n                }\r\n            }, \"GameIcon\")\r\n            .callback((progress) => {\r\n                this.progressBar.progress = progress;\r\n                if (progress == 1) {\r\n                    this.progressNum = progress;\r\n                }\r\n            });\r\n    }\r\n\r\n    /**\r\n     * 載入次資源\r\n     */\r\n    public loadAssetBundle() {\r\n        LoadResManager.instance\r\n            .loadBundle(\"music2\", LoadType.music, \"music\")\r\n            .loadBundle(\"prefab\", LoadType.prefab, \"prefab\")\r\n    }\r\n\r\n    /**\r\n     * 載入外部script資源\r\n     */\r\n    public loadExternalScript() {\r\n        LoadResManager.instance\r\n            .loadExternalScript(\"record.2.0.0\", LoadType.css, \"lib/for1X/css\")\r\n            .loadExternalScript(\"record.2.0.0\", LoadType.css, \"game84/css\")\r\n            .loadExternalScript(\"swiper.min\", LoadType.css, \"lib/for1X/css\")\r\n            .loadExternalScript(\"game-record.2.0.0\", LoadType.script, \"lib/for1X/js\")\r\n            .loadExternalScript(\"vendors\", LoadType.script, \"lib/for1X/js\");\r\n    }\r\n\r\n    /**\r\n     * 更新進度條說明文字,輪播顯示\r\n     * @param {number} textIndex\r\n     */\r\n    public updateProgressText(textIndex: number = 1) {\r\n        textIndex++;\r\n        if (textIndex > 7) textIndex = 1;\r\n        let textHeight = this.loadTextToArray[0].node.height;\r\n        let nextNodeY = this.loadTextToArray[1].node.y;\r\n        this.loadTextToArray[1].string\r\n            = SocketSetting.t(\"DES_00\" + (textIndex));\r\n        cc.tween(this.loadingTextNode)\r\n            .delay(2)\r\n            .to(1, {y: this.loadingTextNode.y + textHeight})\r\n            .call(() => {\r\n                let node = this.loadTextToArray[0].node;\r\n                node.y = nextNodeY - textHeight;\r\n                this.loadTextToArray.splice(0, 1);\r\n                this.loadTextToArray.push(node.getComponent(cc.Label));\r\n                //當進度尚未載入完成,且尚未登入成功,持續遞歸\r\n                if (this.progressNum != 1 || !this.canPlayGame) {\r\n                    this.updateProgressText(textIndex);\r\n                }\r\n            })\r\n            .start();\r\n    }\r\n\r\n    /**\r\n     * 配置該遊戲Scene適配寬高,與更新頻率\r\n     */\r\n    public sceneStyle() {\r\n        SceneManager.instance\r\n            .setDesignWidth(1280)\r\n            .setDesignHeight(720)\r\n            .updateSize(SceneStyle.AUTO)\r\n            .designSceneSizeListenerAutoStart(100);\r\n    }\r\n\r\n\r\n    /**\r\n     * 進入主遊戲按鈕點擊事件\r\n     */\r\n    private intoMainGameButtonEventListener() {\r\n        this.useNoSleep();\r\n        SceneManager.instance.changeScene(\"MainScene\");\r\n        SceneManager.instance.removeScene(this);\r\n    }\r\n\r\n    private useNoSleep() {\r\n        if (!cc.sys.isMobile) {\r\n            cc.log(\"不是mobile\");\r\n            return;\r\n        }\r\n        cc.log(\"我是手機\");\r\n        if (cc.sys.os == cc.sys.OS_IOS) {\r\n            cc.log(\"我是 apple 手機 ,因為無法 noSleep 所以不執行監聽\")\r\n            return;\r\n        }\r\n        if (window.screenLock != 1) {\r\n            cc[\"plug\"] = cc[\"plug\"] || {};\r\n            cc[\"plug\"].noSleep = new NoSleep();\r\n            cc[\"plug\"].noSleep.enable();\r\n            cc.log(cc[\"plug\"].noSleep)\r\n            cc.game.on(cc.game.EVENT_HIDE, function () {\r\n                // cc.log(\"游戏进入后台时触发的事件\");\r\n                cc[\"plug\"].noSleep.disable();\r\n            });\r\n            cc.game.on(cc.game.EVENT_SHOW, function () {\r\n                cc.log(\"近來搂\")\r\n                // cc.log(\"游戏进入前台运行时触发的事件\");\r\n                cc[\"plug\"].noSleep = new NoSleep();\r\n                cc[\"plug\"].noSleep.enable();\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 進入主遊戲按鈕動畫\r\n     */\r\n    private intoMainGameButtonAnimation() {\r\n        cc.tween(this.intoMainGameButton.node)\r\n            .repeatForever(\r\n                cc.tween()\r\n                    .to(1, {y: this.intoMainGameButton.node.y + 15}, {easing: 'bounceIn'})\r\n                    .to(1, {y: this.intoMainGameButton.node.y - 15}, {easing: 'bounceOut'})\r\n            ).start();\r\n    }\r\n\r\n    /**\r\n     * logo進場動畫\r\n     */\r\n    private logoAnimation() {\r\n        cc.tween(this.logoImg.node.parent)\r\n            .parallel(\r\n                cc.tween().to(1.5, {y: 0}, {easing: 'bounceOut'}),\r\n                cc.tween().to(2, {opacity: 255}, {easing: 'smooth'})\r\n            )\r\n            .call(() => {\r\n                this.isLogoAnimaEnd = true;\r\n            })\r\n            .start();\r\n    }\r\n\r\n    /**\r\n     * 監聽當前是否已經進入SFS登入,logo動畫已經結束,主加載已經完成\r\n     * @param {number} dt\r\n     * @protected\r\n     */\r\n    protected update(dt: number) {\r\n        if (this.isLogoAnimaEnd && this.progressNum == 1 && this.canPlayGame) {\r\n            //打開進入主遊戲button\r\n            if (this.progressBar.node.active) {\r\n                this.progressBar.node.active = false;\r\n                this.intoMainGameButton.node.active = true;\r\n                this.intoMainGameButtonAnimation();\r\n            }\r\n        }\r\n    }\r\n\r\n    protected onDestroy() {\r\n        cc.view.off(\"canvas-resize\",this.changeLoadingBG,this);\r\n    }\r\n}\r\n"]}