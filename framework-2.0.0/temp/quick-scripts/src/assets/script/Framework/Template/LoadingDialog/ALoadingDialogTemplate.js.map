{"version":3,"sources":["assets\\script\\Framework\\Template\\LoadingDialog\\ALoadingDialogTemplate.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import ccclass = cc._decorator.ccclass;\r\nimport {ErrorType} from \"../../Error/Enum/ErrorManagerEnum\";\r\nimport ErrorManager from \"../../Error/ErrorManager\";\r\nimport LoadResManager from \"../../LoadResources/LoadResManager\";\r\nimport OverrideComponent from \"../OverrideComponent\";\r\n\r\n/**\r\n * @Author XIAO-LI-PIN\r\n * @Description TODO\r\n * @Date 2021-05-11 下午 05:41\r\n * @Version 1.0\r\n */\r\n@ccclass\r\nexport default abstract class ALoadingDialogTemplate extends OverrideComponent {\r\n\r\n    protected abstract loadingDialogNode: cc.Node;\r\n    protected abstract progressBar: cc.ProgressBar;\r\n    protected abstract progressText: cc.Label;\r\n    protected progressValue: number;\r\n    protected timeOut: number;\r\n    protected addProgressValue;\r\n    private timer: number;\r\n    protected onLoad() {\r\n        this.loadingInitialize();\r\n        this.onCreate();\r\n    }\r\n\r\n    /**\r\n     * 初始化讀取條\r\n     * @private\r\n     */\r\n    private loadingInitialize() {\r\n        this.loadingDialogNode.active = true    //打開組件\r\n        this.loadingDialogNode.opacity = 255    //初使讀取條視窗透明度為0\r\n        this.timer = null;                      //初始setInterval 計時器\r\n        this.progressText.string = \"\"           //初始進度條\"...\"字串為空\r\n        this.progressValue = 0;                 //初始進度條 = 0;\r\n        this.timeOut = 50;                      //初始每跑一次的停留時間\r\n        this.addProgressValue = 0.005           //初始每跑一次初始進度值\r\n\r\n    }\r\n\r\n    public runProgress(resName: string): Promise<void> {\r\n\r\n        this.loadingInitialize();\r\n\r\n        return new Promise<void>(resolve => {\r\n\r\n            if (!this.checkHasRes(resName, resolve)) return;\r\n\r\n            this.progressTimer(\"\", resName, resolve);\r\n\r\n        })\r\n    }\r\n\r\n    private progressTimer(progressText: string, resName: string, resolve: (value: (PromiseLike<void> | void)) => void) {\r\n\r\n        this.timer = window.setInterval(() => {\r\n\r\n            if (this.progressValue > 1) {\r\n                this.progressValue = 0;\r\n            }\r\n\r\n            if (progressText.length > 3) {\r\n                progressText = \"\";\r\n            }\r\n\r\n            this.progressText.string = progressText;\r\n            this.progressBar.progress = this.progressValue;\r\n            this.progressValue = this.progressValue + this.progressValue;\r\n            progressText += \".\";\r\n\r\n            if (LoadResManager.instance.secondaryLoadState.get(resName) == 1) {\r\n\r\n                if (this.progressValue >= 1) {\r\n\r\n                    this.closeLoadingDiaLog(resolve);\r\n                }\r\n\r\n                if (this.addProgressValue != 0.1) this.addProgressValue = 0.05;\r\n            }\r\n\r\n        }, this.timeOut)\r\n    }\r\n\r\n    private closeLoadingDiaLog(resolve: (value: (PromiseLike<void> | void)) => void) {\r\n\r\n        cc.tween(this.loadingDialogNode)\r\n            .to(0.2, {opacity: 0})\r\n            .call(() => {\r\n                this.loadingDialogNode.active = false;\r\n                resolve();\r\n            })\r\n    }\r\n\r\n\r\n    /**\r\n     * 確認當下該資源是否正在加載\r\n     * @param {string} resName\r\n     * @param {(value: (PromiseLike<void> | void)) => void} resolve\r\n     * @returns {boolean}\r\n     * @private\r\n     */\r\n    private checkHasRes(resName: string, resolve: (value: (PromiseLike<void> | void)) => void): boolean {\r\n\r\n        if (!LoadResManager.instance.secondaryLoadState.has(resName)) {\r\n            ErrorManager.instance.executeError(ErrorType.UndefinedFW, `${resName}該無該資源`);\r\n            this.loadingDialogNode.active = false;\r\n            resolve();\r\n            return false;\r\n        }\r\n        if (LoadResManager.instance.secondaryLoadState.get(resName) == 1) {\r\n            this.loadingDialogNode.active = false;\r\n            resolve();\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    protected abstract onCreate();\r\n}"]}