{"version":3,"sources":["assets\\script\\Framework\\Audio\\AudioManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import {IConfigManager} from \"../Config/IConfig/IConfigManager\";\r\nimport {ErrorType} from '../Error/Enum/ErrorManagerEnum'\r\nimport ErrorManager from '../Error/ErrorManager'\r\nimport AudioFactory from './AudioFactory'\r\nimport {AudioStateType} from \"./Enum/AudioStateType\";\r\nimport IAudioManager from \"./IAudio/IAudioManager\";\r\n\r\n/**\r\n * @Author XIAO-LI-PIN\r\n * @Description 音樂管理器,由Config類 實例化該類,直到程式死亡前,永久存活\r\n * @Date 2021-05-13 上午 10:24\r\n * @Version 1.1\r\n */\r\nexport default class AudioManager implements IAudioManager {\r\n\r\n    private configManager: IConfigManager;\r\n    private static _instance: IAudioManager;\r\n    private factory: AudioFactory;              //音樂工廠\r\n    private _musicOnMute: boolean;              //當前是否靜音\r\n    private _effectOnMute: boolean;             //當前是否靜音\r\n\r\n    private constructor(configManager: IConfigManager) {\r\n\r\n        this.configManager = configManager;\r\n        this.factory = new AudioFactory();\r\n        this._effectOnMute = this.configManager.isEffectOnMute;\r\n        this._musicOnMute = this.configManager.isMusicOnMute;\r\n\r\n    }\r\n\r\n    /**\r\n     *  懶漢加載\r\n     *  初始化,只讓一個專案只有一次產生此class\r\n     */\r\n    public static setInstance(configManager: IConfigManager) {\r\n        if (!this._instance) {\r\n            this._instance = new AudioManager(configManager);\r\n        }\r\n    }\r\n\r\n    /**\r\n     *  獲取已經初始化的靜態實例class\r\n     */\r\n    public static get instance(): IAudioManager {\r\n        if (!this._instance) {\r\n            ErrorManager.instance.executeError(ErrorType.MusicFW, \"該類尚未實例化\");\r\n            return;\r\n        }\r\n        return this._instance;\r\n    }\r\n\r\n    /**\r\n     * 額外對該音樂做設定,可以不做設定,將會依照默認設定自動設定\r\n     * volume : 默認為 Config 內的音量參數\r\n     * loop : 默認 false\r\n     * @param {string} name : 音樂名稱\r\n     * @param {number} volume : 音量 0~1\r\n     * @param {boolean} loop : 是否重複撥放\r\n     * @return {this}\r\n     */\r\n    public settingMusic(name: string, volume?: number, loop?: boolean): this {\r\n\r\n        this.factory.settingMusic(name, volume, loop);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 額外對該音效做設定,你可以不做設定,將會依照默認設定自動設定\r\n     * canSuperimpose : 默認 AudioStateType.CLEAR_TO_REPLAY\r\n     * volume : 默認為 Config 內的音量參數\r\n     * loop :默認為 false\r\n     * @param {string} name : 音效檔名\r\n     * @param {AudioStateType} canSuperimpose : 能否疊加\r\n     * @param {number} volume : 音量 0~1\r\n     * @param {boolean} loop : 是否重複撥放\r\n     * @return {this}\r\n     */\r\n    public settingEffect(name: string, canSuperimpose?: AudioStateType, volume?: number, loop?: boolean): this {\r\n\r\n        if (canSuperimpose === AudioStateType.SUPERIMPOSE && loop) {\r\n            ErrorManager.instance.executeError(ErrorType.MusicFW, `${name} 使用疊加效果時不建議使用循環撥放`);\r\n        }\r\n\r\n        this.factory.settingEffect(name, canSuperimpose, volume, loop)\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 撥放音樂,將會依照當初設定的參數進行播放\r\n     * 若無參數設定撥放模式,依照默認參數撥放\r\n     * @param {string} name : 音樂檔名\r\n     */\r\n    public musicPlay(name: string) {\r\n\r\n        this.factory.musicPlay(name);\r\n\r\n    }\r\n\r\n    /**\r\n     * 撥放音效,將會依照當初設定的參數進行播放\r\n     * 若無參數設定撥放模式,依照默認參數撥放\r\n     * @param {string} name : 音效檔名\r\n     */\r\n    public effectPlay(name: string) {\r\n\r\n        this.factory.effectPlay(name);\r\n\r\n    }\r\n\r\n    /**\r\n     * 停止音樂\r\n     */\r\n    public musicStop() {\r\n\r\n        this.factory.musicStop();\r\n\r\n    }\r\n\r\n    /**\r\n     * 暫停音樂\r\n     */\r\n    public musicPause() {\r\n\r\n        this.factory.musicPause();\r\n\r\n    }\r\n\r\n    /**\r\n     * 停止音效\r\n     * @param {string} name : 音效檔名\r\n     */\r\n    public effectStop(name: string) {\r\n\r\n        this.factory.effectStop(name);\r\n    }\r\n\r\n    /**\r\n     * 停止所有音效\r\n     */\r\n    public effectStopAll() {\r\n        this.factory.effectStopAll();\r\n    }\r\n\r\n    /**\r\n     * 獲取撥放的狀態\r\n     * @param {string} name : 音效檔名\r\n     * @return {Map<string, string | boolean | number>} : 撥放設定參數\r\n     */\r\n    public getMusicState(name: string): Map<string, string | boolean | number> {\r\n        return this.factory.getMusicState(name);\r\n    }\r\n\r\n    /**\r\n     * 獲取撥放的狀態\r\n     * @param {string} name : 音樂檔名\r\n     * @return {Map<string, string | AudioStateType |boolean | number>} : 撥放設定參數\r\n     */\r\n    public getEffectState(name: string): Map<string, string | AudioStateType | boolean | number> {\r\n        return this.factory.getEffectState(name);\r\n    }\r\n\r\n    /**\r\n     * 更新當前是否靜音模式\r\n     * @return {boolean} 當前是否靜音\r\n     */\r\n    public updateEffectOnMute(): boolean {\r\n        this._effectOnMute = !this._effectOnMute;\r\n        if (this._effectOnMute) {\r\n            this.factory.effectStopAll();\r\n        }\r\n        return this._effectOnMute;\r\n    }\r\n\r\n    /**\r\n     * 更新當前是否靜音模式\r\n     * @return {boolean} 當前是否靜音\r\n     */\r\n    public updateMusicOnMute(): boolean {\r\n        this._musicOnMute = !this._musicOnMute;\r\n        if (this._musicOnMute) {\r\n            this.musicPause();\r\n        }\r\n        return this._musicOnMute;\r\n    }\r\n\r\n    /**\r\n     * 當前是否靜音背景音樂\r\n     * @returns {boolean}\r\n     */\r\n    public get effectOnMute(): boolean {\r\n        return this._effectOnMute\r\n    }\r\n\r\n    /**\r\n     * 當前是否靜音效果音效\r\n     * @returns {boolean}\r\n     */\r\n    public get musicOnMute(): boolean {\r\n        return this._musicOnMute\r\n    }\r\n}\r\n\r\n/**\r\n * 裝飾器\r\n * 撥放背景音樂\r\n * @param name {string} : 音樂檔名\r\n * @returns {(target: any, key: string, descriptor: PropertyDescriptor) => void}\r\n * @constructor\r\n */\r\nexport function Music(name) {\r\n    return function (target: any, key: string, descriptor: PropertyDescriptor) {\r\n        descriptor.enumerable = true;\r\n        const method = descriptor.value;\r\n        descriptor.value = function (...any) {\r\n            method.call(this, ...any);\r\n            AudioManager.instance.musicPlay(name);\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * 裝飾器\r\n * 停止背景音樂\r\n * @returns {(target: any, key: string, descriptor: PropertyDescriptor) => void}\r\n * @constructor\r\n */\r\nexport function MusicStop() {\r\n    return function (target: any, key: string, descriptor: PropertyDescriptor) {\r\n        descriptor.enumerable = true;\r\n        const method = descriptor.value;\r\n        descriptor.value = function (...any) {\r\n            method.call(this, ...any);\r\n            return AudioManager.instance.musicStop();\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * 裝飾器\r\n * 撥放效果音效\r\n * @param name[] {string} : 音樂檔名\r\n * @returns {(target: any, key: string, descriptor: PropertyDescriptor) => void}\r\n * @constructor\r\n */\r\nexport function Effect(...name: string[]) {\r\n    return function (target: any, key: string, descriptor: PropertyDescriptor) {\r\n        descriptor.enumerable = true;\r\n        const method = descriptor.value;\r\n        descriptor.value = function (...any) {\r\n            name.forEach((name: string) => {\r\n                AudioManager.instance.effectPlay(name);\r\n            })\r\n            return method.call(this, ...any);\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * 裝飾器\r\n * 暫停效果音效\r\n * @param name[] {string} : 音樂檔名\r\n * @returns {(target: any, key: string, descriptor: PropertyDescriptor) => void}\r\n * @constructor\r\n */\r\nexport function EffectStop(...name: string[]) {\r\n    return function (target: any, key: string, descriptor: PropertyDescriptor) {\r\n        descriptor.enumerable = true;\r\n        const method = descriptor.value;\r\n        descriptor.value = function (...any) {\r\n            name.forEach((name: string) => {\r\n                AudioManager.instance.effectStop(name);\r\n            })\r\n            return method.call(this, ...any);\r\n        }\r\n    }\r\n}"]}