{"version":3,"sources":["assets\\script\\Framework\\Template\\ButtonEvent\\MainButton\\AMainGameEvent.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import SocketSetting from \"../../../../Socket/SocketSetting\";\r\nimport {AutoType} from \"../../../Config/Enum/ConfigEnum\";\r\nimport ErrorManager from \"../../../Error/ErrorManager\";\r\nimport {GameState} from \"../../../Process/Enum/GameState\";\r\nimport AutoStateChangeNotification from \"../../../Process/GameNotification/AutoStateChangeNotification\";\r\nimport SpeedStateChangeNotification from \"../../../Process/GameNotification/SpeedStateChangeNotification\";\r\nimport AutoStateChangeObserver from \"../../../Process/GameObserver/AutoStateChangeObserver\";\r\nimport SlotGameManager from \"../../../Process/SlotGameManager\";\r\nimport StopNowStateNotification from \"../../../Slot/SlotNotifivation/StopNowStateNotification\";\r\nimport {ResponseType} from \"../../../WebResponse/Enum/ResponseType\";\r\nimport {WebResponseManager} from \"../../../WebResponse/WebResponseManager\";\r\nimport OverrideComponent from \"../../OverrideComponent\";\r\n\r\n/**\r\n * @Author XIAO-LI-PIN\r\n * @Description (抽象類)遊戲主頁面按鈕事件\r\n * @Date 2021-05-26 上午 11:29\r\n * @Version 1.0\r\n */\r\nexport default abstract class AMainGameEvent extends OverrideComponent {\r\n    /**\r\n     * 當前是否開啟總押注視窗\r\n     * @type {boolean}\r\n     * @protected\r\n     */\r\n    protected isShowTotalBetFrame: boolean;\r\n    /**\r\n     * 當前是否常壓空白建\r\n     * @type {boolean}\r\n     * @protected\r\n     */\r\n    protected keyboardListener: boolean;\r\n    /**\r\n     * 自動狀態事件綁定者\r\n     * @type {AutoStateChangeObserver}\r\n     * @private\r\n     */\r\n    private _autoStateChangeObserver: AutoStateChangeObserver;\r\n    protected tableInfo: ITableInfoModel;\r\n\r\n    protected onLoad() {\r\n        this.isShowTotalBetFrame = false;                                           //當前是否開啟總押注視窗\r\n        this.keyboardListener = false;                                              //當前是否常壓空白建\r\n        this.tableInfo =\r\n            WebResponseManager\r\n                .instance<ITableInfoModel>()\r\n                .getResult(ResponseType.TABLE_INFO);\r\n        AutoStateChangeNotification                                                 //自動按鈕推播事件綁定\r\n            .instance.subscribe(this.getAutoStateChangeObserver(), true);\r\n        this.makeTotalBetButtonToListener();                                        //總押注視窗中按鈕監聽事件\r\n        this.onCreate();                                                            //初始自訂狀態\r\n    }\r\n\r\n    protected start() {\r\n        this.languageSetting();             //更換字體樣式與語系\r\n    }\r\n\r\n    /**\r\n     * 初始自訂狀態\r\n     * 注意:盡量不要使用cocos 內的onLoad();此方法包含在其中\r\n     * @protected\r\n     */\r\n    protected abstract onCreate();\r\n\r\n    /**\r\n     * 如果有需要更換字體樣式與語系,請在這裡使用\r\n     * @protected\r\n     */\r\n    protected abstract languageSetting();\r\n\r\n    /**\r\n     * 打開開始遊戲事件監聽\r\n     */\r\n    public abstract startButtonOnEnable();\r\n\r\n    /**\r\n     * 關閉開始遊戲事件監聽\r\n     */\r\n    public abstract startButtonDisable();\r\n\r\n    /**\r\n     * 點擊 (打開或關閉) 總押注視窗按鈕\r\n     * @param {boolean} isShowTotalBetFrame : 打開或關閉\r\n     * @protected\r\n     */\r\n    protected abstract totalBetFrameTouchEvent(isShowTotalBetFrame: boolean);\r\n\r\n    /**\r\n     * 自行添加押注視窗內所有押注按鈕監聽\r\n     * @protected\r\n     */\r\n    protected abstract makeTotalBetButtonToListener();\r\n\r\n    /**\r\n     * 當下是否(開啟或關閉)加速狀態事件\r\n     * 此方法已經綁定推播事件\r\n     * @param {boolean} isSpeedUp : 開啟或關閉\r\n     * @protected\r\n     */\r\n    protected abstract speedUpEvent(isSpeedUp: boolean);\r\n\r\n    /**\r\n     * 當下是否(開啟或關閉)自動狀態事件\r\n     * 此方法已經綁定推播事件\r\n     * @param {boolean} isAutomaticState :\r\n     * @param {AutoType} autoType\r\n     * @protected\r\n     */\r\n    protected abstract autoEvent(isAutomaticState: boolean, autoType: AutoType);\r\n\r\n    /**\r\n     * 遊戲開始執行流程前事件\r\n     * @protected\r\n     */\r\n    protected abstract startEvent();\r\n\r\n    /**\r\n     * 遊戲開始執行流程完成後事件\r\n     * @protected\r\n     */\r\n    protected abstract endEvent();\r\n\r\n    /**\r\n     * 打開遊戲菜單\r\n     * @protected\r\n     */\r\n    protected abstract menuEvent();\r\n\r\n    /**\r\n     * 警告事件\r\n     * @protected\r\n     */\r\n    protected abstract warningEvent();\r\n\r\n    /**\r\n     * 觸控按壓時監聽\r\n     * @private\r\n     */\r\n    protected startButtonOnTouchStart() {\r\n        this.unschedule(this.longTouchTimer);//清除計時器事件\r\n        //如果該遊戲正在自動模式,將先取消自動狀態\r\n        if (SlotGameManager.instance.isAutoState) {\r\n            //推播auto事件\r\n            this.autoNotify(false, SlotGameManager.instance.autoType);\r\n            return;\r\n        }\r\n        this.scheduleOnce(this.longTouchTimer, 0.5);\r\n    }\r\n    /**\r\n     * 長壓計時器事件,如果當前非auto狀態,將會開啟auto 並開始遊戲\r\n     * @returns {Promise<void>}\r\n     * @private\r\n     */\r\n    private async longTouchTimer() {\r\n        //推播auto事件\r\n        this.autoNotify(true, SlotGameManager.instance.autoType);\r\n        if (SlotGameManager.instance.isAutoState) {\r\n            await this.startButtonEvent();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 推播auto事件\r\n     * @private\r\n     */\r\n    private autoNotify(isAuto: boolean, autoType: AutoType) {\r\n        AutoStateChangeNotification\r\n            .instance.notify(isAuto, autoType, autoType);\r\n    }\r\n\r\n    /**\r\n     * start監聽抬起時狀態\r\n     * 取消長壓計時器事件,並進入開始遊戲事件\r\n     * @private\r\n     */\r\n    protected async startButtonOnTouchEnd() {\r\n        this.unschedule(this.longTouchTimer);\r\n        await this.startButtonEvent();\r\n    }\r\n\r\n    /**\r\n     * 鍵盤空白鍵壓下時監聽\r\n     * @param event\r\n     * @private\r\n     */\r\n    protected keyboardSpaceTouchStart(event) {\r\n        switch (event.keyCode) {\r\n            case cc.macro.KEY.space:\r\n                if (!this.keyboardListener) {\r\n                    this.keyboardListener = true;\r\n                    this.startButtonOnTouchStart();\r\n                }\r\n                break;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 鍵盤空白鍵抬起時監聽\r\n     * @param event\r\n     * @private\r\n     */\r\n    protected async keyboardSpaceTouchEnd(event) {\r\n        switch (event.keyCode) {\r\n            case cc.macro.KEY.space:\r\n                await this.startButtonOnTouchEnd();\r\n                this.keyboardListener = false;\r\n                break;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 自動狀態監聽者\r\n     * 如有需求可自行override or 獲取監聽對象做關閉操作\r\n     * @returns {AutoStateChangeObserver}\r\n     * @protected\r\n     */\r\n    protected getAutoStateChangeObserver(): AutoStateChangeObserver {\r\n        if (!this._autoStateChangeObserver) {\r\n            this._autoStateChangeObserver =\r\n                new AutoStateChangeObserver(async (isAutomaticState, beforeAutoCount, afterAutoCount) => {\r\n                    this.autoEvent(isAutomaticState, afterAutoCount);\r\n                    if (isAutomaticState) {\r\n                        await this.startButtonEvent();\r\n                    }\r\n                }, this);\r\n        }\r\n        return this._autoStateChangeObserver;\r\n    }\r\n\r\n    /**\r\n     * 開始遊戲監聽事件\r\n     * @returns {Promise<void>}\r\n     * @protected\r\n     */\r\n    protected async startButtonEvent() {\r\n        do {\r\n            //如果當下總押注視窗開啟中,更改為執行關閉總押注視窗\r\n            if (this.isShowTotalBetFrame) {\r\n                this.isShowTotalBetFrame = !this.isShowTotalBetFrame;\r\n                this.totalBetFrameTouchEvent(false);\r\n                return;\r\n            }\r\n            //如果遊戲為執行中狀態,將可以即停操作\r\n            if (SlotGameManager.instance.gameState != GameState.STANDBY && SlotGameManager.instance.gameState != GameState.FREEING) {\r\n                //推播即停事件\r\n                StopNowStateNotification.instance.notify();\r\n                return;\r\n            }\r\n            //判斷當前是金額足夠\r\n            let nowUserBetIndex = SlotGameManager.instance.userBetPoint.LineBet;\r\n            let userBet = this.tableInfo.LineTotalBet[nowUserBetIndex];\r\n\r\n            //如果用戶金額不足的情況\r\n            if (SlotGameManager.instance.userMoney - userBet < 0) {\r\n                ErrorManager.instance.serverError(false, SocketSetting.t(\"S_9003\"));\r\n                return;\r\n            }\r\n\r\n            this.startEvent();\r\n            await SlotGameManager.instance.play();\r\n            this.endEvent();\r\n\r\n        } while (SlotGameManager.instance.isAutoState || SlotGameManager.instance.gameState === GameState.FREEING);\r\n    }\r\n\r\n    /**\r\n     * 自動按鈕監聽事件\r\n     * 如果當前押注視窗開啟中,將更換為關閉視窗方法\r\n     * 正常情況,推播當前auto狀態事件\r\n     * @private\r\n     */\r\n    protected async autoButtonEventListener() {\r\n        this.unschedule(this.longTouchTimer);//將長案事件失效\r\n        //如果當前押注視窗開啟中,將更換為關閉視窗方法\r\n        if (this.isShowTotalBetFrame) {\r\n            this.isShowTotalBetFrame = !this.isShowTotalBetFrame;\r\n            this.totalBetFrameTouchEvent(false);\r\n            return;\r\n        }\r\n        let isAuto = SlotGameManager.instance.isAutoState;\r\n        this.autoNotify(!isAuto, SlotGameManager.instance.autoType);\r\n    }\r\n\r\n    /**\r\n     * 加速按鈕監聽事件\r\n     * @protected\r\n     */\r\n    protected speedUpButtonEventListener() {\r\n\r\n        let isSpeedUp = SlotGameManager.instance.isSpeedUp;\r\n\r\n        SpeedStateChangeNotification.instance.notify(!isSpeedUp);\r\n\r\n        this.speedUpEvent(SlotGameManager.instance.isSpeedUp);\r\n\r\n    }\r\n\r\n    /**\r\n     * 打開或開關閉押注金額選擇框\r\n     * 如果當前在遊戲中,將方法更改為顯示警告視窗\r\n     * @protected\r\n     */\r\n    protected totalBetFrameTouchEventListener() {\r\n        //如果當前在遊戲中,將無法打開總押注視窗\r\n        if (SlotGameManager.instance.gameState != GameState.STANDBY) {\r\n            this.warningEvent();\r\n            return;\r\n        }\r\n        this.isShowTotalBetFrame = !this.isShowTotalBetFrame;\r\n        this.totalBetFrameTouchEvent(this.isShowTotalBetFrame);\r\n    }\r\n\r\n    /**\r\n     * menu按鈕監聽事件\r\n     * 如果當前在遊戲中,將方法更改為顯示警告視窗\r\n     * @protected\r\n     */\r\n    protected menuButtonEventListener() {\r\n        if (SlotGameManager.instance.gameState != GameState.STANDBY) {\r\n            this.warningEvent();\r\n            return;\r\n        }\r\n        this.menuEvent();\r\n    }\r\n}"]}