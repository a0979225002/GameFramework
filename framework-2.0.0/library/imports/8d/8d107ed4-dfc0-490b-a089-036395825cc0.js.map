{"version":3,"sources":["assets\\script\\MainGameScript\\Controller\\FreeEndController.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,mEAA0F;AAC1F,qEAAkD;AAE5C,IAAA,KAAsB,EAAE,CAAC,UAAU,EAAlC,OAAO,aAAA,EAAE,QAAQ,cAAiB,CAAC;AAG1C;IAA+C,qCAAY;IAA3D;QAAA,qEA4EC;QAzEW,mBAAa,GAAa,IAAI,CAAC;;IAyE3C,CAAC;0BA5EoB,iBAAiB;IAaxB,kCAAM,GAAhB;QACI,mBAAiB,CAAC,QAAQ,GAAG,IAAI,CAAC;QAClC,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;QACzB,IAAI,CAAC,YAAY,GAAG,IAAI,IAAI,CAAC,YAAY,EAAE,CAAC;IAEhD,CAAC;IAEO,6CAAiB,GAAzB;QACI,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;QACpB,IAAI,CAAC,QAAQ,GAAG,CAAC,CAAC;QAClB,IAAI,CAAC,aAAa,CAAC,MAAM,GAAG,EAAE,CAAC;IACnC,CAAC;IAEM,uCAAW,GAAlB,UAAmB,KAAa,EAAE,IAAY;QAD9C,iBAYC;QATG,IAAI,CAAC,iBAAiB,EAAE,CAAC;QACzB,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;QACxB,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;QACnB,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;QAEjB,OAAO,IAAI,OAAO,CAAO,UAAA,OAAO;YAC5B,KAAI,CAAC,QAAQ,EAAE,CAAC;YAChB,KAAI,CAAC,OAAO,GAAG,OAAO,CAAC;QAC3B,CAAC,CAAC,CAAA;IACN,CAAC;IAGO,wCAAY,GAApB;QADA,iBAWC;QATG,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC;QAC3B,IAAI,CAAC,aAAa,GAAG,KAAK,CAAC;QAC3B,IAAI,CAAC,aAAa,CAAC,MAAM,GAAG,GAAG,GAAG,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QAE1E,UAAU,CAAC;YACP,KAAI,CAAC,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;YACzB,sBAAY,CAAC,QAAQ,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;YACvC,KAAI,CAAC,OAAO,EAAE,CAAC;QACnB,CAAC,EAAE,IAAI,CAAC,CAAA;IACZ,CAAC;IAIO,oCAAQ,GAAhB;QACI,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;IAC9B,CAAC;IAES,kCAAM,GAAhB,UAAiB,EAAU;QAEvB,IAAI,IAAI,CAAC,aAAa,EAAE;YAEpB,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,IAAI,GAAG,EAAE,CAAC;YAE7C,IAAI,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,KAAK,EAAE;gBAC5B,IAAI,CAAC,YAAY,EAAE,CAAC;gBACpB,OAAO;aACV;YAED,IAAI,QAAQ,GAAG,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC,GAAG,EAAE,CAAC,CAAC;YAC7E,IAAI,QAAQ,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,EAAE;gBAC7B,QAAQ,GAAG,QAAQ,GAAG,IAAI,CAAA;aAC7B;YACD,IAAI,CAAC,aAAa,CAAC,MAAM,GAAG,MAAI,QAAU,CAAC;SAC9C;IACL,CAAC;;IAxED;QADC,QAAQ,CAAC,EAAE,CAAC,KAAK,CAAC;sDACI,EAAE,oBAAF,EAAE,CAAC,KAAK;4DAAQ;IAuBvC;QADC,iCAAO,CAAC,QAAQ,CAAC;;;4DAC+B,OAAO,oBAAP,OAAO;wDAWvD;IAGD;QADC,yBAAU,CAAC,UAAU,CAAC;;;;yDAWtB;IAID;QAFC,qBAAM,CAAC,UAAU,CAAC;QAClB,oBAAK,CAAC,UAAU,CAAC;;;;qDAGjB;IAxDgB,iBAAiB;QADrC,OAAO;OACa,iBAAiB,CA4ErC;IAAD,wBAAC;CA5ED,AA4EC,CA5E8C,EAAE,CAAC,SAAS,GA4E1D;kBA5EoB,iBAAiB","file":"","sourceRoot":"/","sourcesContent":["import AudioManager, {Music, EffectStop, Effect} from '../../Framework/Audio/AudioManager'\r\nimport {Loading} from \"./LoadingDialogController\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class FreeEndController extends cc.Component {\r\n\r\n    @property(cc.Label)\r\n    private totalWinPoint: cc.Label = null;\r\n\r\n    private startNum: number;\r\n    private isCanRunPoint: boolean;\r\n    private point: number;\r\n    private time: number;\r\n    private numberFormat: Intl.NumberFormat\r\n    private resolve: (value: (PromiseLike<void> | void)) => void\r\n    public static instance :FreeEndController;\r\n\r\n    protected onLoad() {\r\n        FreeEndController.instance = this;\r\n        this.node.active = false;\r\n        this.numberFormat = new Intl.NumberFormat();\r\n\r\n    }\r\n\r\n    private initializeFreeEnd() {\r\n        this.resolve = null;\r\n        this.startNum = 0;\r\n        this.totalWinPoint.string = \"\";\r\n    }\r\n    @Loading(\"prefab\")\r\n    public showFreeEnd(point: number, time: number): Promise<void> {\r\n\r\n        this.initializeFreeEnd();\r\n        this.node.active = true;\r\n        this.point = point;\r\n        this.time = time;\r\n\r\n        return new Promise<void>(resolve => {\r\n            this.runPoint();\r\n            this.resolve = resolve;\r\n        })\r\n    }\r\n\r\n    @EffectStop(\"runPoint\")\r\n    private closeFreeEnd() {\r\n        this.startNum = this.point;\r\n        this.isCanRunPoint = false;\r\n        this.totalWinPoint.string = \"$\" + this.numberFormat.format(this.startNum);\r\n\r\n        setTimeout(() => {\r\n            this.node.active = false;\r\n            AudioManager.instance.musicPlay(\"NBS\");\r\n            this.resolve();\r\n        }, 3000)\r\n    }\r\n\r\n    @Effect(\"runPoint\")\r\n    @Music(\"FGBigWin\")\r\n    private runPoint() {\r\n        this.isCanRunPoint = true;\r\n    }\r\n\r\n    protected update(dt: number) {\r\n\r\n        if (this.isCanRunPoint) {\r\n\r\n            this.startNum += this.point / this.time * dt;\r\n\r\n            if (this.startNum > this.point) {\r\n                this.closeFreeEnd();\r\n                return;\r\n            }\r\n\r\n            let nowPoint = this.numberFormat.format(Math.floor(this.startNum * 10) / 10);\r\n            if (nowPoint.indexOf(\".\") == -1) {\r\n                nowPoint = nowPoint + \".0\"\r\n            }\r\n            this.totalWinPoint.string = `$${nowPoint}`;\r\n        }\r\n    }\r\n}"]}