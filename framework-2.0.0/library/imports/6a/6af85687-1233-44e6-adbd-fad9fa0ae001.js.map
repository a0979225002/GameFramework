{"version":3,"sources":["assets\\script\\MainGameScript\\Controller\\FreeOpenController.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import {Music, Effect} from '../../Framework/Audio/AudioManager'\r\nimport {AutoType} from '../../Framework/Config/Enum/ConfigEnum'\r\nimport SlotGameManager from '../../Framework/Process/SlotGameManager'\r\nimport AGenericTemplate from '../../Framework/Template/AGenericTemplate'\r\nimport {ResponseType} from \"../../Framework/WebResponse/Enum/ResponseType\";\r\nimport NoLineFreeResult from \"../../Framework/WebResponse/SeverDataModel/FreeResult/NoLineFreeResult\";\r\nimport {WebResponseManager} from '../../Framework/WebResponse/WebResponseManager'\r\nimport {Loading} from \"./LoadingDialogController\";\r\n\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class FreeOpenController extends AGenericTemplate {\r\n\r\n    @property(cc.Label)\r\n    private freeCountLabel: cc.Label = null;\r\n    @property(cc.Animation)\r\n    private freeAnimation: cc.Animation = null;\r\n    private freeCount = 0;\r\n    private count: number = 0;\r\n    private resolve: (value: (PromiseLike<void> | void)) => void\r\n    private timer: number;\r\n    private CLOSING : boolean;\r\n    private freeResult:INoLineFreeResultModel;\r\n    public static instance: FreeOpenController;\r\n\r\n    public onCreate() {\r\n        FreeOpenController.instance = this;\r\n        this.freeResult =\r\n            WebResponseManager\r\n                .instance<NoLineFreeResult>()\r\n                .getResult(ResponseType.FREE);\r\n        this.initialFreeOpen();\r\n    }\r\n\r\n    private initialFreeOpen() {\r\n        this.CLOSING = false;\r\n        this.freeCountLabel.string = \"\";\r\n        this.count = 0;\r\n        this.node.active = false;\r\n        this.freeAnimation.node.width = 0;\r\n        this.freeAnimation.node.height = 0;\r\n        this.node.opacity = 255;\r\n    }\r\n\r\n    /**\r\n     * 打開free 開場動畫\r\n     * @param {number} freeCount\r\n     * @return {Promise<void>}\r\n     */\r\n    @Loading(\"prefab\")\r\n    public showFreeOpeningAnimation(freeCount: number): Promise<void> {\r\n        this.playFreeAnimation(freeCount);\r\n        this.freeAnimation.once('finished', this.freeCountAnimation, this);\r\n        return new Promise(resolve => {\r\n            this.resolve = resolve;\r\n        })\r\n    }\r\n\r\n    /**\r\n     * 跑Free 總共次數動畫\r\n     * @private\r\n     */\r\n    @Effect(\"GetWin\")\r\n    private freeCountAnimation() {\r\n        cc.log(\"freeCountAnimation\")\r\n        if (SlotGameManager.instance.isAutoState && SlotGameManager.instance.autoType != AutoType.freeEnd) {\r\n            this.timer = 3;\r\n        } else {\r\n            this.timer = 10;\r\n        }\r\n        if (this.freeResult.FreeToFree != 0) {\r\n            this.timer = 1;\r\n        }\r\n        this.schedule(this.addCountTimer, 0.016 * 5);\r\n    }\r\n\r\n    private addCountTimer() {\r\n        this.count++;\r\n        if (this.count > this.freeCount) {\r\n            this.touchEndListener();\r\n            this.unschedule(this.addCountTimer);\r\n            this.scheduleOnce(this.removeFreeOpeningAnimation, this.timer)\r\n            return;\r\n        }\r\n        this.freeCountLabel.string = String(this.count);\r\n    }\r\n\r\n    private touchEndListener() {\r\n        this.freeAnimation.node.once(cc.Node.EventType.TOUCH_END, this.removeFreeOpeningAnimation, this);\r\n        cc.systemEvent.once(cc.SystemEvent.EventType.KEY_DOWN, this.keyboardEvent, this);\r\n    }\r\n\r\n    private keyboardEvent(event) {\r\n        switch (event.keyCode) {\r\n            case cc.macro.KEY.space:\r\n                this.removeFreeOpeningAnimation();\r\n                break;\r\n        }\r\n    }\r\n\r\n\r\n    @Music(\"GetFG\")\r\n    private playFreeAnimation(freeCount: number) {\r\n        this.node.active = true;\r\n        this.freeCount = freeCount;\r\n        this.freeAnimation.play();\r\n    }\r\n\r\n    /**\r\n     * 關閉free開場動畫\r\n     */\r\n    @Music(\"FBS\")\r\n    private removeFreeOpeningAnimation() {\r\n        this.unschedule(this.removeFreeOpeningAnimation);\r\n        this.freeAnimation.node.off(cc.Node.EventType.TOUCH_END, this.removeFreeOpeningAnimation, this);\r\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this.keyboardEvent, this);\r\n        cc.tween(this.node)\r\n            .to(0.4, {opacity: 0})\r\n            .call(() => {\r\n                this.initialFreeOpen();\r\n                this.resolve();\r\n            })\r\n            .start();\r\n    }\r\n\r\n\r\n    public languageSetting() {\r\n    }\r\n}\r\n"]}